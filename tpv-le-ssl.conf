<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName tpv.triditive.com
    ServerAdmin webmaster@triditive.com

    # Proxy only API calls to Node.js
    ProxyPreserveHost On

    # Proxy /api/* to Node.js backend
    ProxyPass /api http://localhost:3001/api
    ProxyPassReverse /api http://localhost:3001/api

    # Static file handling for frontend
    DocumentRoot /home/amcell/farm_management/frontend
    <Directory /home/amcell/farm_management/frontend>
        Require all granted
        Options -Indexes +FollowSymLinks

        # Handle SPA routing - serve index.html for all routes
        RewriteEngine On
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/farm_management_error.log
    CustomLog ${APACHE_LOG_DIR}/farm_management_access.log combined

    # Security headers
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    # File upload size limit (10MB)
    LimitRequestBody 10485760

    # SSL Configuration
    SSLCertificateFile /etc/letsencrypt/live/tpv.triditive.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/tpv.triditive.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
</IfModule>